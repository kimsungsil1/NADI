<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI 디자인 어시스턴트</title>
  <link rel="stylesheet" href="styles.css">
  <script src="./assets/nav.js" defer></script>
</head>
<body>
  <div id="global-nav">
    <noscript class="cta-noscript">
      <style>
        .cta-noscript { display:flex; flex-wrap:wrap; gap:8px; padding:10px 16px; background:#f7e7e3; border-bottom:1px solid #eadedb; }
        .cta-noscript a { display:inline-flex; align-items:center; padding:8px 12px; border-radius:6px; border:1px solid #d7c6c1; color:#5c4330; text-decoration:none; font-weight:600; }
      </style>
      <a href="./booking.html">예약하기</a>
      <a href="./membership.html">회원권</a>
      <a href="./giftcard.html">상품권</a>
      <a href="./ai.html">AI 디자인</a>
    </noscript>
  </div>
  <header class="hero">
    <div class="hero-content">
      <h1>AI 디자인 어시스턴트</h1>
      <p>셀카와 원하는 스타일을 입력하면 제미니가 추천안을 제공합니다.</p>
    </div>
  </header>

  <main class="page">
    <section class="card">
      <label>예약번호 (선택) <input type="text" id="bookingId" placeholder="예약 번호"></label>
      <label>휴대폰번호 <input type="tel" id="phone" placeholder="010-0000-0000"></label>
      <label>프롬프트 <textarea id="prompt" rows="3" placeholder="속눈썹 이렇게 해줘"></textarea></label>
      <label>셀카 업로드 <input type="file" id="selfie" accept="image/png,image/jpeg"></label>
      <label class="checkbox"><input type="checkbox" id="consent"> 개인정보 제공 및 일정 기간 보관에 동의합니다.</label>
      <button id="aiBtn" class="primary">결과 받기</button>
      <pre id="aiResult" class="muted"></pre>
    </section>
  </main>

  <div id="global-footer-links"></div>

  <script>
    const apiBase = localStorage.getItem('nadiApiBase') || 'http://localhost:3000';
    document.getElementById('aiBtn').addEventListener('click', async ()=>{
      const form = new FormData();
      const file = document.getElementById('selfie').files[0];
      if (file) form.append('selfie', file);
      form.append('prompt', document.getElementById('prompt').value);
      form.append('bookingId', document.getElementById('bookingId').value);
      form.append('customerId', (await lookupCustomer()).id);
      form.append('consent', document.getElementById('consent').checked ? 'true' : 'false');
      const resp = await fetch(`${apiBase}/api/ai/design`, {method:'POST', body: form});
      const data = await resp.json();
      document.getElementById('aiResult').textContent = JSON.stringify(data.result, null, 2);
    });

    async function lookupCustomer(){
      const phone = document.getElementById('phone').value;
      const resp = await fetch(`${apiBase}/api/customers/lookup`, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({phone, name: 'AI 고객'})});
      return resp.json();
    }
  </script>
</body>
</html>
